name: consistency_test

on:
  push:
    branches:
      - 'master'
    paths-ignore:
      - 'doc/**'
      - 'CHANGELOG'
      - 'COPYING'
      - 'LICENSE.txt'
      - 'README.md'
  pull_request:
    branches:
      - '*'
    paths-ignore:
      - 'doc/**'
      - 'CHANGELOG'
      - 'COPYING'
      - 'LICENSE.txt'
      - 'README.md'

jobs:
  run-test-suite:
    name: run test suite
    runs-on: ubuntu-latest

    strategy:
      fail-fast: false

    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      - name: Build docker
        run: docker build -f docker/Dockerfile_deb11_pyjeo_public . -t docker-pyjeo:1.0
      - name: Run the test suite
        run: |
          docker run --rm -v ${GITHUB_WORKSPACE}/tests:/tests:ro --cpus=2 -m 20g docker-pyjeo:1.0 python -W ignore -m unittest -v tests
